<!DOCTYPE html>
<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
    <title>things-scene-three-container Demo</title>

    <script src="../../webcomponentsjs/webcomponents-lite.min.js"></script>

    <link rel="import" href="../../things-scene-viewer/things-scene-viewer.html">
    <link rel="import" href="../../things-scene-modeler/things-scene-properties.html">
    <link rel="import" href="../../things-scene-indoor-map/things-scene-indoor-map.html">
    <link rel="import" href="../../things-scene-forklift/things-scene-forklift.html">
    <link rel="import" href="../../things-scene-person/things-scene-person.html">
    
    <link rel="import" href="./things-subscriber.html">

    <link rel="import" href="./things-scene-three-container.html">

    <style is="custom-style">

    @font-face {
      font-family: "Bitstream Vera Serif Bold";
      src: url("fonts/VeraSeBd.ttf");
    }

    things-scene-viewer {
      display: block;
      width: 100%;
      height: 560px;
    }

    </style>
  </head>
  <body unresolved>
    <template is="dom-bind" id="app">
      <style is="custom-style">
      :root {
        --things-scene-three-container: {
          width: 100%;
          height: 100%;;
        }
      }

      main {
        position: relative;
      }

      main>.content{
        width: 1000px;
        height: 800px;
      }

      .button-group {
        position: absolute;
        top: 10px;
        left: 10px;
      }

      </style>

      <p>An example of <code>&lt;things-scene-three-container&gt;</code>:</p>

      <things-subscriber id="subscriber"
                         message="{{message}}">
      </things-subscriber>

      <things-scene-viewer id='scene'
                           scene='{{scene}}'
                           selected='{{selected}}'
                           model='[[model]]'
                           values="[[message]]"
                           mode="1">
        <things-scene-layer type="selection-layer"></things-scene-layer>
        <things-scene-layer type="modeling-layer"></things-scene-layer>
        <things-scene-handler type="text-editor"></things-scene-handler>
        <things-scene-handler type="move-handler"></things-scene-handler>
      </things-scene-viewer>

      <things-scene-properties scene="[[scene]]"
                               selected="[[selected]]"
                               model="{{target}}"
                               bounds="{{bounds}}">
        <fieldset class="same-width">
          <legend>Three Container Properties</legend>

          <label>3D Mode</label>
          <input type="checkbox" checked="{{target.threed::change}}">

          <label>FOV</label>
          <input type="number" value-as-number="{{target.fov::change}}">

          <label>Near</label>
          <input type="number" value-as-number="{{target.near::change}}">

          <label>Far</label>
          <input type="number" value-as-number="{{target.far::change}}">

          <label>Zoom</label>
          <input type="number" value-as-number="{{target.zoom::change}}">

          <label>Auto Rotate</label>
          <input type="checkbox" checked="{{target.autoRotate::change}}">

        </fieldset>
      </things-scene-properties>

    </template>

    <script>
      window.addEventListener('WebComponentsReady', function(e) {
        var app = document.querySelector('#app')

        app.$.subscriber.start()

        var zeroToNine = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]

        function buildRow(top, left, area) {

          return zeroToNine.map(function(x) {
            return {
              type : 'rack',
              location : `LOC-${area}-${top}-${x+1}-A`,
              left : left + 50 * x,
              top : 100 * top,
              width : 50,
              height : 20,
              depth : 30,
              shelves : 4,
              rotation: 0
            }
          }).concat(zeroToNine.map(function(x) {
            return {
              type : 'rack',
              location : `LOC-${area}-${top}-${x+1}-B`,
              left : left + 50 * x,
              top : 100 * top + 20,
              width : 50,
              height : 20,
              depth : 30,
              shelves : 4,
              rotation : Math.PI
            }
          }))
        }

        var racks = [1, 2, 3, 4, 5, 6].map(function(top) {
          return buildRow(top, 50, 1).concat((buildRow(top, 650, 2)))
        }).reduce(function(racks, row) {
          return racks.concat(row)
        }, [])

        racks.push({
          type : 'forklift',
          left : 600,
          top : 600,
          width : 10,
          height : 10,
          depth : 10
        })
        racks.push({
          type : 'forklift',
          left : 100,
          top : 100,
          width : 10,
          height : 10,
          depth : 10
        })
        racks.push({
          type : 'forklift',
          left : 200,
          top : 500,
          width : 10,
          height : 10,
          depth : 10
        })
        racks.push({
          type : 'person',
          left : 600,
          top : 200,
          width : 10,
          height : 10,
          depth : 10
        })
        racks.push({
          type : 'person',
          left : 300,
          top : 100,
          width : 10,
          height : 10,
          depth : 10
        })
        racks.push({
          type : 'person',
          left : 200,
          top : 600,
          width : 10,
          height : 10,
          depth : 10
        })
        racks.push({
          type:'rect',
          left: 600,
          top : 600,
          width: 50,
          height : 50,
          fillStyle: {
            type: 'pattern',
            image: './images/livevideo-play.png'
          }
        });

        app.model = {
          width: 1600,
          height: 1200,
          unit: 'cm',
          components: [{
            type: 'three-container',
            left: 10,
            top: 10,
            width: 1200,
            height: 800,
            text: 'First Floor',
            textAlign: 'top',
            fillStyle: 'darkgray',
            fov: 20,
            near: 0.1,
            far: 2000,
            zoom: 100,
            threed: true,
            locked: true,
            fillStyle: {
              type: 'pattern',
              image: './images/warehouse-floor-plan-layout.jpg'
              // ,
              // offsetX: parseInt(this.pattern.offsetX) || 0,
              // offsetY: parseInt(this.pattern.offsetY) || 0,
              // width: parseInt(this.pattern.width),
              // height: parseInt(this.pattern.height),
              // align: this.pattern.align,
              // fitPattern: this.pattern.fitPattern
            },
            // autoRotate : true,
            autoRotate : false,
            components: racks
          }, {
            type: 'rect',
            left: 50,
            top: 50,
            width: 200,
            height: 200,
            fillStyle: 'red'
          }]
        }

      });
    </script>

  </body>
</html>
