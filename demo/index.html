<!DOCTYPE html>
<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
    <title>things-scene-three-container Demo</title>

    <script src="../../webcomponentsjs/webcomponents-lite.min.js"></script>

    <link rel="import" href="../../things-scene-viewer/things-scene-viewer.html">
    <link rel="import" href="../../things-scene-modeler/things-scene-properties.html">
    <link rel="import" href="../../things-scene-indoor-map/things-scene-indoor-map.html">
    <link rel="import" href="../../things-scene-forklift/things-scene-forklift.html">
    <link rel="import" href="../../things-scene-person/things-scene-person.html">

    <link rel="import" href="./things-subscriber.html">

    <link rel="import" href="./things-scene-three-container.html">

    <style is="custom-style">

    @font-face {
      font-family: "Bitstream Vera Serif Bold";
      src: url("fonts/VeraSeBd.ttf");
    }

    things-scene-viewer {
      display: block;
      width: 100%;
      height: 560px;
    }

    </style>
  </head>
  <body unresolved>
    <template is="dom-bind" id="app">
      <style is="custom-style">
      :root {
        --things-scene-three-container: {
          width: 100%;
          height: 100%;;
        }
      }

      main {
        position: relative;
      }

      main>.content{
        width: 1000px;
        height: 800px;
      }

      .button-group {
        position: absolute;
        top: 10px;
        left: 10px;
      }

      </style>

      <p>An example of <code>&lt;things-scene-three-container&gt;</code>:</p>

      <things-subscriber id="subscriber"
                         message="{{message}}">
      </things-subscriber>

      <things-scene-viewer id='scene'
                           scene='{{scene}}'
                           selected='{{selected}}'
                           model='[[model]]'
                           variables="{{variables}}"
                           values="[[message]]"
                           mode="1">
        <things-scene-layer type="selection-layer"></things-scene-layer>
        <things-scene-layer type="modeling-layer"></things-scene-layer>
        <things-scene-handler type="text-editor"></things-scene-handler>
        <things-scene-handler type="move-handler"></things-scene-handler>
      </things-scene-viewer>

      <things-scene-properties scene="[[scene]]"
                               selected="[[selected]]"
                               model="{{target}}"
                               bounds="{{bounds}}">
        <fieldset class="same-width">
          <legend>Three Container Properties</legend>

          <label>3D Mode</label>
          <input type="checkbox" checked="{{target.threed::change}}">

          <label>FOV</label>
          <input type="number" value-as-number="{{target.fov::change}}">

          <label>Near</label>
          <input type="number" value-as-number="{{target.near::change}}">

          <label>Far</label>
          <input type="number" value-as-number="{{target.far::change}}">

          <label>Zoom</label>
          <input type="number" value-as-number="{{target.zoom::change}}">

          <label>Auto Rotate</label>
          <input type="checkbox" checked="{{target.autoRotate::change}}">

        </fieldset>
      </things-scene-properties>

    </template>

    <script>
      window.addEventListener('WebComponentsReady', function(e) {
        var app = document.querySelector('#app')

        app.$.subscriber.start()

        var zeroToNine = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]

        function buildRow(top, left, area) {

          return zeroToNine.map(function(x) {
            return {
              type : 'rack',
              location : `LOC-${area}-${top}-${x+1}-A`,
              left : left + 50 * x,
              top : 100 * top,
              width : 50,
              height : 20,
              depth : 30,
              shelves : 4,
              rotation: 0,
              fillStyle: "#e6e6fa"
            }
          }).concat(zeroToNine.map(function(x) {
            return {
              type : 'rack',
              location : `LOC-${area}-${top}-${x+1}-B`,
              left : left + 50 * x,
              top : 100 * top + 20,
              width : 50,
              height : 20,
              depth : 30,
              shelves : 4,
              rotation : Math.PI
            }
          }))
        }

        var components = [1, 2, 3, 4, 5, 6].map(function(top) {
          return buildRow(top, 50, 1).concat((buildRow(top, 650, 2)))
        }).reduce(function(components, row) {
          return components.concat(row)
        }, [])

        components.push({
          type : 'forklift',
          left : 600,
          top : 600,
          width : 10,
          height : 10,
          depth : 10
        })
        components.push({
          type : 'forklift',
          left : 100,
          top : 100,
          width : 10,
          height : 10,
          depth : 10
        })
        components.push({
          type : 'forklift',
          left : 200,
          top : 500,
          width : 10,
          height : 10,
          depth : 10
        })
        components.push({
          type : 'person',
          left : 600,
          top : 200,
          width : 10,
          height : 10,
          depth : 10
        })
        components.push({
          type : 'person',
          left : 300,
          top : 100,
          width : 10,
          height : 10,
          depth : 10
        })
        components.push({
          type : 'person',
          left : 200,
          top : 600,
          width : 10,
          height : 10,
          depth : 10
        })
        components.push({
          type:'rect',
          left: 600,
          top : 600,
          width: 50,
          height : 50,
          fillStyle: {
            type: 'pattern',
            image: './images/livevideo-play.png',
            fitPattern: true
          }
        }
        // , {
        //   type : 'humidity-sensor',
        //   id: 'sensor',
        //   cx : 80,
        //   cy : 80,
        //   zPos: 100,
        //   rx: 50,
        //   ry: 50,
        //   depth : 50,
        //   humidity: [
        //     Math.floor(Math.random() * 40) - 10,
        //     Math.floor(Math.random() * 80)
        //   ]
        // }, {
        //   type : 'humidity-sensor',
        //   id: 'sensor',
        //   cx : 1000,
        //   cy : 80,
        //   zPos: 100,
        //   rx: 50,
        //   ry: 50,
        //   depth : 50,
        //   humidity: [
        //     Math.floor(Math.random() * 40) - 10,
        //     Math.floor(Math.random() * 80)
        //   ]
        // }, {
        //   type : 'humidity-sensor',
        //   id: 'sensor',
        //   cx : 80,
        //   cy : 800,
        //   zPos: 100,
        //   rx: 50,
        //   ry: 50,
        //   depth : 50,
        //   humidity: [
        //     Math.floor(Math.random() * 40) - 10,
        //     Math.floor(Math.random() * 80)
        //   ]
        // }, {
        //   type : 'humidity-sensor',
        //   id: 'sensor',
        //   cx : 1000,
        //   cy : 800,
        //   zPos: 100,
        //   rx: 50,
        //   ry: 50,
        //   depth : 50,
        //   humidity: [
        //     Math.floor(Math.random() * 40) - 10,
        //     Math.floor(Math.random() * 80)
        //   ]
        // }
        , {
          type: 'wall',
          left: 0,
          top: 0,
          width: 10,
          height: 800,
          depth: 100,
          fillStyle: 'brown'
        }, {
          type: 'wall',
          left: 0,
          top: 0,
          width: 1200,
          height: 10,
          depth: 100,
          fillStyle: 'brown'
        }, {
          type: 'wall',
          left: 1190,
          top: 0,
          width: 10,
          height: 800,
          depth: 100,
          fillStyle: 'brown'
        }, {
          type: 'wall',
          left: 0,
          top: 790,
          width: 550,
          height: 10,
          depth: 100,
          opacity : 0.7,
          fillStyle: 'brown'
        }, {
          type: 'wall',
          left: 650,
          top: 790,
          width: 550,
          height: 10,
          depth: 100,
          opacity : 0.7,
          fillStyle: 'brown'
        }
        // , {
        //   type: 'door',
        //   left: 550,
        //   top: 793,
        //   width: 100,
        //   height: 5,
        //   depth: 100
        // }
        // inside wall
        , {
            type: 'wall',
            left: 5,
            top: 370,
            width: 1190,
            height: 5,
            depth: 100,
            fillStyle: 'brown'
        }
        );

        // components.push({
        //   type:'path',
        //   x1: 0,
        //   y1 : 0,
        //   x2: 1200,
        //   y2 : 800
        // })

        app.model = {
          width: 1600,
          height: 1200,
          unit: 'cm',
          components: [{
            type: 'three-container',
            left: 10,
            top: 10,
            width: 1200,
            height: 800,
            text: 'First Floor',
            textAlign: 'top',
            fillStyle: 'darkgray',
            fov: 20,
            near: 0.1,
            far: 2000,
            zoom: 100,
            threed: true,
            locked: true,
            fillStyle: {
              type: 'pattern',
              image: 'http://factory.hatiolab.com/rest/download/827c5983-ea0a-4b57-af1f-e245ca094496'
              // ,
              // offsetX: parseInt(this.pattern.offsetX) || 0,
              // offsetY: parseInt(this.pattern.offsetY) || 0,
              // width: parseInt(this.pattern.width),
              // height: parseInt(this.pattern.height),
              // align: this.pattern.align,
              // fitPattern: this.pattern.fitPattern
            },
            // autoRotate : true,
            autoRotate : false,
            components: components
          }
          // , {
          //   type: 'video-player-360',
          //   left: 50,
          //   top: 50,
          //   width: 1000,
          //   height: 400,
          //   src: 'http://streams.kolor.com/streams/856cf3af-bf09-4e78-acb8-3f829e18fdd6/source.03-1080p_HD.mp4',
          //   // src: 'http://streams.kolor.com/streams/3fcee1a9-9cca-4742-8171-ac6e0de530a2/source.03-1080p_HD.mp4',
          //   fillStyle: 'red',
          //   strokeStyle: 'green',
          //   lineWidth: 3,
          //   // autoplay: true,
          //   loop: true,
          //   mute: true,
          //   fov: 35,
          //   flatProjection: false
          // },{
          //   type: 'video-player-360',
          //   left: 50,
          //   top: 500,
          //   width: 1000,
          //   height: 400,
          //   // src: 'http://streams.kolor.com/streams/3fcee1a9-9cca-4742-8171-ac6e0de530a2/source.03-1080p_HD.mp4',
          //   fillStyle: 'red',
          //   strokeStyle: 'black',
          //   // autoplay: true,
          //   loop: true,
          //   // clickAndDrag: false,
          //   fov: 35,
          //   flatProjection: false
          // }
        ]
        }

        app.variables = {
          key : "humidity",
          mappings:[{
            param: null,
            property:"data",
            rule:"value",
            target:"#sensor"
          }],
          name: "STOCK LEVEL",
          type: "object",
          value: [1,2]
        }

        setInterval(function(){
          app.message = {
            data: {

                humidity: [
                  Math.floor(Math.random() * 40) - 10,
                  Math.floor(Math.random() * 70)
                ]
              }

            }
          }, 1000)


      });
    </script>

  </body>
</html>
