!function e(t,n,o){function i(a,s){if(!n[a]){if(!t[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(r)return r(a,!0);var h=new Error("Cannot find module '"+a+"'");throw h.code="MODULE_NOT_FOUND",h}var l=n[a]={exports:{}};t[a][0].call(l.exports,function(e){var n=t[a][1][e];return i(n?n:e)},l,l.exports,e,t,n,o)}return n[a].exports}for(var r="function"==typeof require&&require,a=0;a<o.length;a++)i(o[a]);return i}({1:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(){if(!a.done){a.done=!0;var e=new THREE.OBJLoader,t=new THREE.MTLLoader;e.setPath("./obj/Fork_lift/"),t.setPath("./obj/Fork_lift/"),t.load("ForkLift.mtl",function(t){t.preload(),e.setMaterials(t),t.side=THREE.frontSide,e.load("ForkLift.obj",function(e){s=e})})}}Object.defineProperty(n,"__esModule",{value:!0});var s,c=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),h=function(e){function t(e,n){o(this,t);var r=i(this,Object.getPrototypeOf(t).call(this));return r._model=e,r.createObject(e,n),r}return r(t,e),c(t,[{key:"createObject",value:function(e,n){if(!t.extObject)return void setTimeout(this.createObject.bind(this,e,n),50);{var o=e.left+e.width/2-n.width/2,i=e.top+e.height/2-n.height/2;.5*e.depth,e.left-n.width/2,e.top-n.height/2,e.rotation}this.type="forklift",this.add(t.extObject.clone()),this.scale.set(10,10,10),this.position.set(o,0,i),this.rotation.y=e.rotation||0}}],[{key:"extObject",get:function(){return s||a(),s}}]),t}(THREE.Object3D);n["default"]=h},{}],2:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=["#6666ff","#ccccff","#ffcccc","#cc3300"],c=function(e){function t(e,n,r){o(this,t);var a=i(this,Object.getPrototypeOf(t).call(this));return a._model=e,a._container=r,a.userData.temperature=e.humidity?e.humidity[0]:0,a.userData.humidity=e.humidity?e.humidity[1]:0,a.createObject(e,n),a}return r(t,e),a(t,[{key:"createObject",value:function(e,t){{var n=e.cx-t.width/2,o=e.cy-t.height/2,i=(e.zPos||0)+e.depth/2;e.rotation}this.type="humidity-sensor",e.location&&(this.name=e.location);for(var r=0;3>r;r++){var a=this.createSensor(e.rx*(1+.5*r),e.ry*(1+.5*r),e.depth*(1+.5*r),r);a.material.opacity=.5-.15*r}this.position.set(n,i,o),this.rotation.y=e.rotation||0,this._container._heatmap.addData({x:Math.floor(e.cx),y:Math.floor(e.cy),value:this.userData.temperature}),this._container.updateHeatmapTexture()}},{key:"createSensor",value:function(e,t,n,o){var i,r=0===o,a=new THREE.SphereGeometry(e,32,32);i=r?new THREE.MeshLambertMaterial({color:"#cc3300",side:THREE.FrontSide}):new THREE.MeshBasicMaterial({color:"#cc3300",side:THREE.FrontSide,wireframe:!0,wireframeLinewidth:1});var s=new THREE.Mesh(a,i);return s.material.transparent=!0,r?s.onmousemove=this.onmousemove:s.raycast=function(){},this.add(s),s}},{key:"onUserDataChanged",value:function(){var e=this._model,t=e.cx,n=e.cy;t=Math.floor(t),n=Math.floor(n);var o=this.userData.temperature,i=!0,r=!1,a=void 0;try{for(var c,h=this.children[Symbol.iterator]();!(i=(c=h.next()).done);i=!0){var l=c.value,u=0;u=0>o?0:10>o?1:20>o?2:3,l.material.color.set(s[u])}}catch(d){r=!0,a=d}finally{try{!i&&h["return"]&&h["return"]()}finally{if(r)throw a}}var f=this._container._heatmap._store._data,p=f[t][n];this._container._heatmap.addData({x:t,y:n,value:o-p}),this._container._heatmap.repaint(),this._container.updateHeatmapTexture()}},{key:"onmousemove",value:function(e,t){var n=t.tooltip||t._scene2d.getObjectByName("tooltip");if(n&&(t._scene2d.remove(n),t.tooltip=null,t.render_threed()),this.parent.visible){this.parent.userData||(this.parent.userData={});var o="";for(var i in this.parent.userData)this.parent.userData[i]&&(o+=i+": "+this.parent.userData[i]+"\n");if(o.length>0){n=t.tooltip=t.makeTextSprite(o);var r=new THREE.Vector3,a=n.getWorldScale().clone(),s=a.x/t.model.width,c=a.y/t.model.height;r.set(t._mouse.x,t._mouse.y,.5),a.normalize(),a.x=a.x/2*s,a.y=-a.y/2*c,a.z=0,r.add(a),r.unproject(t._2dCamera),n.position.set(r.x,r.y,r.z),n.name="tooltip",n.scale.x=n.scale.x*s,n.scale.y=n.scale.y*c,t._scene2d.add(n),t._renderer&&t._renderer.render(t._scene2d,t._2dCamera),t.invalidate()}}}}]),t}(THREE.Object3D);n["default"]=c;var h=scene,l=h.Component,u=h.Ellipse,d=n.Sensor=function(e){function t(){return o(this,t),i(this,Object.getPrototypeOf(t).apply(this,arguments))}return r(t,e),a(t,[{key:"_draw",value:function(e){var t=this.bounds,n=t.left,o=t.top,i=t.width,r=t.height;e.beginPath(),e.rect(n,o,i,r),this.model.fillStyle={type:"pattern",fitPattern:!0,image:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAABBCAYAAACTiffeAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyppVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTMyIDc5LjE1OTI4NCwgMjAxNi8wNC8xOS0xMzoxMzo0MCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUuNSAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpDQ0E1QkUzRTRDMDcxMUU2QkMyRDk3MzlGN0EzMTI2NSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpDQ0E1QkUzRjRDMDcxMUU2QkMyRDk3MzlGN0EzMTI2NSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjJFQ0Q4QzE5NEI1MjExRTZCQzJEOTczOUY3QTMxMjY1IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjJFQ0Q4QzFBNEI1MjExRTZCQzJEOTczOUY3QTMxMjY1Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+tgU1kQAAB4pJREFU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"},this.drawFill(e)}}]),t}(u);l.register("humidity-sensor",d)},{}],3:[function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("./three-container");Object.defineProperty(n,"ThreeContainer",{enumerable:!0,get:function(){return o(i)["default"]}});var r=e("./video-player-360");Object.defineProperty(n,"VideoPlayer360",{enumerable:!0,get:function(){return o(r)["default"]}})},{"./three-container":9,"./video-player-360":12}],4:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=["#6666ff","#ccccff","#ffcccc","#cc3300"],c=function(e){function t(e,n,r){o(this,t);var a=i(this,Object.getPrototypeOf(t).call(this));return a._model=e,a._container=r,a.createObject(e,n),a}return r(t,e),a(t,[{key:"createObject",value:function(e,t){var n=e.x1-t.width/2,o=e.y1-t.height/2,i=e.x2-t.width/2,r=e.y2-t.height/2,a=0,s=e.lineWidth||5;this.type="path",e.location&&(this.name=e.location);var c=new THREE.LineBasicMaterial({color:3355443,linewidth:s}),h=new THREE.Geometry;h.vertices.push(new THREE.Vector3(n,a,o)),h.vertices.push(new THREE.Vector3(i,a,r));var l=new THREE.Line(h,c);this.add(l)}},{key:"createSensor",value:function(e,t,n,o){var i,r=0===o,a=new THREE.SphereGeometry(e,32,32);i=r?new THREE.MeshLambertMaterial({color:"#cc3300",side:THREE.FrontSide}):new THREE.MeshBasicMaterial({color:"#cc3300",side:THREE.FrontSide,wireframe:!0,wireframeLinewidth:1});var s=new THREE.Mesh(a,i);return s.material.transparent=!0,this.add(s),s}},{key:"onUserDataChanged",value:function(){var e=this._model,t=e.cx,n=e.cy;t=Math.floor(t),n=Math.floor(n);var o=this.userData.temperature,i=!0,r=!1,a=void 0;try{for(var c,h=this.children[Symbol.iterator]();!(i=(c=h.next()).done);i=!0){var l=c.value,u=0;u=0>o?0:10>o?1:20>o?2:3,l.material.color.set(s[u])}}catch(d){r=!0,a=d}finally{try{!i&&h["return"]&&h["return"]()}finally{if(r)throw a}}var f=this._container._heatmap._store._data,p=f[t][n];this._container._heatmap.addData({x:t,y:n,value:o-p}),this._container._heatmap.repaint(),this._container.updateHeatmapTexture()}}]),t}(THREE.Object3D);n["default"]=c;var h=scene,l=h.Component,u=h.Line,d=n.LinePath=function(e){function t(){return o(this,t),i(this,Object.getPrototypeOf(t).apply(this,arguments))}return r(t,e),t}(u);l.register("path",d)},{}],5:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(){if(!a.done){a.done=!0;var e=new THREE.TGALoader;THREE.Loader.Handlers.add(/\.tga$/i,e);var t=new THREE.OBJLoader,n=new THREE.MTLLoader;t.setPath("./obj/Casual_Man_02/"),n.setPath("./obj/Casual_Man_02/"),n.load("Casual_Man.mtl",function(e){e.preload(),t.setMaterials(e),e.side=THREE.frontSide,t.load("Casual_Man.obj",function(e){s=e})})}}Object.defineProperty(n,"__esModule",{value:!0});var s,c=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),h=function(e){function t(e,n){o(this,t);var r=i(this,Object.getPrototypeOf(t).call(this));return r._model=e,r.createObject(e,n),r}return r(t,e),c(t,[{key:"createObject",value:function(e,n){if(!t.extObject)return void setTimeout(this.createObject.bind(this,e,n),50);{var o=e.left+e.width/2-n.width/2,i=e.top+e.height/2-n.height/2;.5*e.depth,e.left-n.width/2,e.top-n.height/2,e.rotation}this.type="person",this.add(t.extObject.clone()),this.scale.set(10,10,10),this.position.set(o,0,i),this.rotation.y=e.rotation||0}}],[{key:"extObject",get:function(){return s||a(),s}}]),t}(THREE.Object3D);n["default"]=h},{}],6:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=scene,c=(s.Component,function(e){function t(e,n){o(this,t);var r=i(this,Object.getPrototypeOf(t).call(this));return r._model=e,r.createObject(e,n),r}return r(t,e),a(t,[{key:"createObject",value:function(e,t){this.createPlane(e.width,e.height,e.fillStyle);var n=e.left+e.width/2-t.width/2,o=e.top+e.height/2-t.height/2;this.position.x=n,this.position.z=o}},{key:"createPlane",value:function(e,t,n){if(this.geometry=new THREE.PlaneGeometry(e,t),n&&"pattern"==n.type&&n.image){var o=(new THREE.TextureLoader).load(n.image);o.wrapS=THREE.RepeatWrapping,o.wrapT=THREE.RepeatWrapping,o.repeat.set(1,1),this.material=new THREE.MeshBasicMaterial({map:o,side:THREE.FrontSide})}else this.material=new THREE.MeshBasicMaterial({color:n||"#ccaa76",side:THREE.FrontSide});this.rotation.x=-Math.PI/2,this.type="rect"}}]),t}(THREE.Mesh));n["default"]=c},{}],7:[function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),c=e("./stock"),h=o(c),l=function(e){function t(e,n){i(this,t);var o=r(this,Object.getPrototypeOf(t).call(this));return o._model=e,o.createObject(e,n),o.castShadow=!0,o}return a(t,e),s(t,[{key:"createObject",value:function(e,t){var n=.7,o=e.left+e.width/2-t.width/2,i=e.top+e.height/2-t.height/2,r=.5*e.depth*e.shelves,a=e.rotation;this.type=e.type;var s=this.createRackFrame(e.width,e.height,e.depth*e.shelves);this.add(s);for(var c=0;c<e.shelves;c++){var l=-e.depth*e.shelves*.5;if(c>0){var u=this.createRackBoard(e.width,e.height);u.position.set(0,l+e.depth*c,0),u.rotation.x=Math.PI/2,u.material.opacity=.5,u.material.transparent=!0,this.add(u)}var d=new h["default"]({width:e.width*n,height:e.height*n,depth:e.depth*n}),f=e.depth*n;d.position.set(0,l+e.depth*c+.5*f,0),d.name=e.location+"-"+(c+1),this.add(d)}this.position.set(o,r,i),this.rotation.y=a||0}},{key:"createRackFrame",value:function(e,t,n){return this.geometry=this.cube({width:e,height:n,depth:t}),new THREE.LineSegments(this.geometry,new THREE.LineDashedMaterial({color:13421772,dashSize:3,gapSize:1,linewidth:1}))}},{key:"createRackBoard",value:function(e,t){var n=new THREE.MeshBasicMaterial({color:"#dedede",side:THREE.DoubleSide}),o=new THREE.PlaneGeometry(e,t,1,1),i=new THREE.Mesh(o,n);return i}},{key:"cube",value:function(e){var t=.5*e.width,n=.5*e.height,o=.5*e.depth,i=new THREE.Geometry;return i.vertices.push(new THREE.Vector3(-t,-n,-o),new THREE.Vector3(-t,n,-o),new THREE.Vector3(-t,n,-o),new THREE.Vector3(t,n,-o),new THREE.Vector3(t,n,-o),new THREE.Vector3(t,-n,-o),new THREE.Vector3(t,-n,-o),new THREE.Vector3(-t,-n,-o),new THREE.Vector3(-t,-n,o),new THREE.Vector3(-t,n,o),new THREE.Vector3(-t,n,o),new THREE.Vector3(t,n,o),new THREE.Vector3(t,n,o),new THREE.Vector3(t,-n,o),new THREE.Vector3(t,-n,o),new THREE.Vector3(-t,-n,o),new THREE.Vector3(-t,-n,-o),new THREE.Vector3(-t,-n,o),new THREE.Vector3(-t,n,-o),new THREE.Vector3(-t,n,o),new THREE.Vector3(t,n,-o),new THREE.Vector3(t,n,o),new THREE.Vector3(t,-n,-o),new THREE.Vector3(t,-n,o)),i}},{key:"raycast",value:function(){}}]),t}(THREE.Object3D);n["default"]=l},{"./stock":8}],8:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=["black","#ccaa76","#ff1100","#252525","#6ac428"],c=function(e){function t(e){o(this,t);var n=i(this,Object.getPrototypeOf(t).call(this));return n._model=e,n.createObject(e),n}return r(t,e),a(t,[{key:"createObject",value:function(e){this.createStock(e.width,e.height,e.depth)}},{key:"createStock",value:function(e,t,n){this.geometry=new THREE.BoxGeometry(e,n,t),this.material=new THREE.MeshLambertMaterial({color:"#ccaa76",side:THREE.FrontSide}),this.type="stock",this.castShadow=!0}},{key:"onUserDataChanged",value:function(){this.material.color.set(s[this.userData.status]),this.visible=0===this.userData.status?!1:!0}},{key:"onmousemove",value:function(e,t){var n=t.tooltip||t._scene2d.getObjectByName("tooltip");if(n&&(t._scene2d.remove(n),t.tooltip=null,t.render_threed()),this.visible){this.userData||(this.userData={});var o="";for(var i in this.userData)this.userData[i]&&(o+=i+": "+this.userData[i]+"\n");if(o.length>0){n=t.tooltip=t.makeTextSprite(o);var r=new THREE.Vector3,a=n.getWorldScale().clone(),s=a.x/t.model.width,c=a.y/t.model.height;r.set(t._mouse.x,t._mouse.y,.5),a.normalize(),a.x=a.x/2*s,a.y=-a.y/2*c,a.z=0,r.add(a),r.unproject(t._2dCamera),n.position.set(r.x,r.y,r.z),n.name="tooltip",n.scale.x=n.scale.x*s,n.scale.y=n.scale.y*c,t._scene2d.add(n),t._renderer&&t._renderer.render(t._scene2d,t._2dCamera),t.invalidate()}}}}]),t}(THREE.Mesh);n["default"]=c},{}],9:[function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(){s.done||(THREE.Loader.Handlers.add(/\.tga$/i,new THREE.TGALoader),s.done=!0)}Object.defineProperty(n,"__esModule",{value:!0});var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},h=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),l=function x(e,t,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,t);if(void 0===o){var i=Object.getPrototypeOf(e);return null===i?void 0:x(i,t,n)}if("value"in o)return o.value;var r=o.get;return void 0===r?void 0:r.call(n)},u=e("./rack"),d=o(u),f=e("./plane"),p=o(f),m=e("./forkLift"),y=o(m),v=e("./person"),E=o(v),b=e("./humidity-sensor"),_=o(b),w=e("./path"),g=o(w),T=e("./three-layout"),R=(o(T),e("./three-controls")),O=o(R),k=scene,j=k.Component,P=k.Container,M=k.Layout,H=function(e){function t(){return i(this,t),r(this,Object.getPrototypeOf(t).apply(this,arguments))}return a(t,e),h(t,[{key:"createFloor",value:function(e,t,n){var o,i=this.model.fillStyle,r=this;if("pattern"==i.type&&i.image){var a=new THREE.TextureLoader,s=THREE.XHRLoader.prototype.load,c=function(){this.withCredentials=!0,s.apply(this,arguments)};THREE.XHRLoader.prototype.load=c,a.setCrossOrigin("use-credentials");var h=a.load(this.app.url(i.image),function(){r.render_threed(),THREE.XHRLoader.prototype.load=s});o=new THREE.MeshBasicMaterial({map:h,side:THREE.DoubleSide,specular:328965})}else o=new THREE.MeshBasicMaterial({color:e,side:THREE.FrontSide});var l=new THREE.PlaneGeometry(t,n),u=new THREE.Mesh(l,o);u.receiveShadow=!0,u.rotation.x=-Math.PI/2,u.position.y=-2,u.name="floor",this._scene3d.add(u)}},{key:"createObjects",value:function(e,t){var n=this;e.forEach(function(e){var o;switch(e.type){case"rack":o=new d["default"](e,t);break;case"forklift":o=new y["default"](e,t);break;case"person":o=new E["default"](e,t);break;case"rect":o=new p["default"](e,t);break;case"humidity-sensor":o=new _["default"](e,t,n);break;case"path":o=new g["default"](e,t,n)}o&&n._scene3d.add(o)})}},{key:"createHeatmap",value:function(e,t){if(this._model.useHeatmap!==!1){var n=document.createElement("div");this._heatmap=h337.create({container:n,width:e,height:t,radius:Math.sqrt(e*e+t*t)/4});var o=new THREE.MeshBasicMaterial({side:THREE.FrontSide,transparent:!0,visible:!1}),i=new THREE.PlaneGeometry(e,t),r=new THREE.Mesh(i,o);r.rotation.x=-Math.PI/2,r.position.y=-1,r.name="heatmap",this._scene3d.add(r)}}},{key:"navigatePath",value:function(e){for(var t in e){var n=e[t],o=this.findTarget(n);this.emphasizeTarget(o);var i=o.parent;i.geometry.computeBoundingBox();var r=i.geometry.boundingBox,a=this.makeTextSprite(Number(t)+1,{backgroundColor:"rgba(0,0,0,0)",borderColor:"rgba(0,0,0,0)"});a.position.set(0,100,0);var s=this.createNotifyCone();a.position.set(0,r.max.y+40,0),s.position.set(0,r.max.y+10,0),a.name=n+"-nav",s.name=n+"-cone",i.add(a),i.add(s)}this.render_threed()}},{key:"findTarget",value:function(e){var t=this._scene3d.getObjectByName(e,!0);if(t)return t}},{key:"emphasizeTarget",value:function(e){this._scene3d.updateMatrixWorld();var t=new THREE.BoxHelper(e,16724787);t.material.linewidth=10,t.name=e.name+"-emp",this._scene3d.add(t)}},{key:"createNotifyCone",value:function(){var e=new THREE.ConeGeometry(10,10,32,!0),t=new THREE.MeshBasicMaterial({color:16724736}),n=new THREE.Mesh(e,t);return n.rotation.z=Math.PI,n}},{key:"findPath",value:function(e){var t=this._scene3d.getObjectByName(e,!0);if(t){t=t.parent,this._scene3d.updateMatrixWorld();var n=t.getWorldPosition(),o=(t.getWorldScale(),new THREE.BoxHelper(t,16724787));return o.material.linewidth=.1*this.model.zoom,this._scene3d.add(o),{x:n.x,y:n.y,z:n.z}}}},{key:"drawPath",value:function(e,t){var n=t.x,o=(t.y,t.z),i=e.x,r=(e.y,e.z),a=5,s=new THREE.LineBasicMaterial({color:16724787,linewidth:a}),c=new THREE.Geometry;c.vertices.push(new THREE.Vector3(i,0,r)),c.vertices.push(new THREE.Vector3(n,0,o));var h=new THREE.Line(c,s);return this._scene3d.add(h),t}},{key:"updateHeatmapTexture",value:function(){var e=this._scene3d.getObjectByName("heatmap",!0),t=new THREE.Texture(this._heatmap._renderer.canvas);t.needsUpdate=!0,e.material.map=t,e.material.visible=!0}},{key:"makeTextSprite",value:function(e,t){if(e){void 0===t&&(t={});var n=t.hasOwnProperty("fontFace")?t.fontFace:"Arial",o=t.hasOwnProperty("fontSize")?t.fontSize:90,i=t.hasOwnProperty("textColor")?t.textColor:"rgba(255,30,30,1)",r=t.hasOwnProperty("textBorderColor")?t.textBorderColor:"rgba(0,0,0,1)",a=t.hasOwnProperty("borderWidth")?t.borderWidth:4,s=t.hasOwnProperty("borderColor")?t.borderColor:"rgba(0, 0, 0, 1.0)",c=t.hasOwnProperty("backgroundColor")?t.backgroundColor:"rgba(255, 255, 255, 1.0)",h=t.hasOwnProperty("radius")?t.radius:30,l=t.hasOwnProperty("vAlign")?t.vAlign:"middle",u=t.hasOwnProperty("hAlign")?t.hAlign:"center",d=document.createElement("canvas"),f=d.getContext("2d");d.width=window.innerWidth,d.height=window.innerHeight,f.font=o+"px "+n,f.textBaseline="alphabetic",f.textAlign="left";var p=0,m=String(e).split("\n"),y=d.width/2,v=d.height/2;for(var E in m){var b=f.measureText(m[E]);p<b.width&&(p=b.width)}var _=p/2,w=o/2;"bottom"==l?w=0:"top"==l&&(w=o),"left"==u?_=p:"right"==u&&(_=0),this.roundRect(f,y-_,v-w*m.length+.28*o,p,1.28*o*m.length,h,a,s,c),f.fillStyle=i,f.strokeStyle=r,f.lineWidth=3;for(var g in m)f.fillText(m[g],y-_,v+w/m.length*(g+1)),f.strokeText(m[g],y-_,v+w/m.length*(g+1));var T=new THREE.Texture(d);T.needsUpdate=!0;var R=new THREE.SpriteMaterial({map:T}),O=new THREE.Sprite(R);return O.scale.set(window.innerWidth/2,window.innerWidth/4,1),O.raycast=function(){},O}}},{key:"destroy_scene3d",value:function(){this.stop(),this._renderer&&this._renderer.clear(),this._renderer=void 0,this._camera=void 0,this._2dCamera=void 0,this._keyboard=void 0,this._controls=void 0,this._projector=void 0,this._load_manager=void 0,this._scene3d=void 0,this._scene2d=void 0}},{key:"init_scene3d",value:function(){this._scene3d&&this.destroy_scene3d(),s();var e=this.model,t=e.width,n=e.height,o=e.fov,i=void 0===o?45:o,r=e.near,a=void 0===r?.1:r,c=e.far,h=void 0===c?2e4:c,l=e.fillStyle,u=void 0===l?"#424b57":l,d=e.light,f=void 0===d?16777215:d,p=this.hierarchy.components,m=void 0===p?[]:p;this._scene3d=new THREE.Scene,this._scene2d=new THREE.Scene;var y=t/n;this._camera=new THREE.PerspectiveCamera(i,y,a,h),this._2dCamera=new THREE.OrthographicCamera(-t/2,t/2,n/2,-n/2,1,1e3),this._scene3d.add(this._camera),this._scene2d.add(this._2dCamera),this._camera.position.set(800,800,800),this._2dCamera.position.set(800,800,800),this._camera.lookAt(this._scene3d.position),this._2dCamera.lookAt(this._scene2d.position),this._renderer=new THREE.WebGLRenderer({alpha:!0}),this._renderer.autoClear=!1,this._renderer.setClearColor(16777215,0),this._renderer.setSize(t,n),this._renderer.shadowMap.enabled=!0,this._controls=new O["default"](this._camera,this);var v=new THREE.PointLight(f,1);this._camera.add(v),this._camera.castShadow=!0,this._raycaster=new THREE.Raycaster,this._mouse=new THREE.Vector2,this._tick=0,this._clock=new THREE.Clock(!0),this.createHeatmap(t,n),this.createFloor(u,t,n),this.createObjects(m,{width:t,height:n}),this._load_manager=new THREE.LoadingManager,this._load_manager.onProgress=function(){},this.animate()}},{key:"animate",value:function(){this._animationFrame=requestAnimationFrame(this.animate.bind(this));this._clock.getDelta();this.update()}},{key:"stop",value:function(){cancelAnimationFrame(this._animationFrame)}},{key:"update",value:function(){this._controls.update()}},{key:"render_threed",value:function(){this._renderer.clear(),this._renderer&&this._renderer.render(this._scene3d,this._camera),this._renderer&&this._scene2d&&this._scene2d.children.length>0&&this._renderer.render(this._scene2d,this._2dCamera),this.invalidate()}},{key:"_draw",value:function(){this.model.threed||l(Object.getPrototypeOf(t.prototype),"_draw",this).call(this)}},{key:"_post_draw",value:function(e){{var n=this,o=this.model,i=o.left,r=o.top,a=o.width,s=o.height,c=o.threed;o.fov,o.near,o.far,o.zoom,o.light}if(c){if(this._scene3d||(this.init_scene3d(),this.render_threed()),this._dataChanged){if(console.log("dataChanged",this._data),this._pickingLocations)for(var h in this._pickingLocations){var u=this._pickingLocations[h],d=this._scene3d.getObjectByName(u,!0);d&&(d.userData={});var f=this._scene3d.getObjectByName(u+"-emp",!0);f&&this._scene3d.remove(f);var p=this._scene3d.getObjectByName(u+"-cone",!0);p&&p.parent.remove(p);var m=this._scene3d.getObjectByName(u+"-nav",!0);m&&m.parent.remove(m)}if(this._selectedPickingLocation){var y=this._scene3d.getObjectByName(this._selectedPickingLocation,!0);y&&y.userData&&delete y.userData.selected}this._pickingLocations=[],this._selectedPickingLocation=null,this._data&&this._data.forEach(function(e){var t=n._scene3d.getObjectByName(e.loc,!0);t&&(t.userData=e,t.onUserDataChanged(),e.navigationData&&n._pickingLocations.push(e.loc),e.selected&&(n._selectedPickingLocation=e.loc))}),this._dataChanged=!1,this.navigatePath(this._pickingLocations)}this.showTooltip(this._selectedPickingLocation),e.drawImage(this._renderer.domElement,0,0,a,s,i,r,a,s);

}else l(Object.getPrototypeOf(t.prototype),"_post_draw",this).call(this,e)}},{key:"roundRect",value:function(e,t,n,o,i,r,a,s,c){if(void 0!=c||void 0!=s){var h=t-a-r,l=h+o+2*a+2*r,u=n-a-r,d=u+i+2*a+2*r;e.beginPath(),e.moveTo(h+r,u),e.lineTo(l-r,u),e.quadraticCurveTo(l,u,l,u+r),e.lineTo(l,d-r),e.quadraticCurveTo(l,d,l-r,d),e.lineTo(h+r,d),e.quadraticCurveTo(h,d,h,d-r),e.lineTo(h,u+r),e.quadraticCurveTo(h,u,h+r,u),e.closePath(),e.lineWidth=a,void 0!=c&&(e.fillStyle=c,e.fill()),a>0&&void 0!=s&&(e.strokeStyle=s,e.stroke())}}},{key:"getObjectByRaycast",value:function(){var e,t=this.getObjectsByRaycast();return t.length>0&&(e=t[0].object),e}},{key:"getObjectsByRaycast",value:function(){var e=this._mouse;if(this._camera){this._raycaster.setFromCamera(e,this._camera);var t=this._raycaster.intersectObjects(this._scene3d.children,!0);return t}}},{key:"showTooltip",value:function(e){if(e){var t=this._scene2d.getObjectByName("navigator-tooltip");t&&this._scene2d.remove(t);var n=this._scene3d.getObjectByName(e,!0),o=this._scene3d.getObjectByName(e+"-cone",!0);if(n&&o){var i=o.getWorldPosition().clone();i.project(this._camera),i.z=.5;var r="";for(var a in n.userData)n.userData[a]&&"object"!=c(n.userData[a])&&"loc"!=a&&(r+=a+": "+n.userData[a]+"\n");t=this.makeTextSprite(r);var s=t.getWorldScale().clone(),h=s.x/this.model.width,l=s.y/this.model.height;s.normalize(),s.x=s.x/2*h,s.y=-s.y/2*l,s.z=0,i.add(s),i.unproject(this._2dCamera),t.position.set(i.x,i.y,i.z),t.name="navigator-tooltip",t.scale.x=t.scale.x*h,t.scale.y=t.scale.y*l,this._scene2d.add(t),this.render_threed()}}}},{key:"onchange",value:function(e){(e.hasOwnProperty("width")||e.hasOwnProperty("height")||e.hasOwnProperty("threed"))&&this.destroy_scene3d(),e.hasOwnProperty("autoRotate")&&(this._controls.autoRotate=e.autoRotate),(e.hasOwnProperty("fov")||e.hasOwnProperty("near")||e.hasOwnProperty("far")||e.hasOwnProperty("zoom"))&&(this._camera.near=this.model.near,this._camera.far=this.model.far,this._camera.zoom=.01*this.model.zoom,this._camera.fov=this.model.fov,this._camera.updateProjectionMatrix(),this._controls.cameraChanged=!0),e.hasOwnProperty("data")&&this._data!==e.data&&(this._data=e.data,this._dataChanged=!0),this.invalidate()}},{key:"onmousedown",value:function(e){this._controls&&this._controls.onMouseDown(e)}},{key:"onmousemove",value:function(e){if(this._controls){var t=this.transcoordC2S(e.offsetX,e.offsetY);this._mouse.x=(t.x-this.model.left)/this.model.width*2-1,this._mouse.y=2*-((t.y-this.model.top)/this.model.height)+1;var n=this.getObjectByRaycast();n&&n.onmousemove&&n.onmousemove(e,this),this._controls.onMouseMove(e),e.stopPropagation()}}},{key:"onwheel",value:function(e){this._controls&&(this.handleMouseWheel(e),e.stopPropagation())}},{key:"ondragstart",value:function(e){this._controls&&(this._controls.onDragStart(e),e.stopPropagation())}},{key:"ondragmove",value:function(e){this._controls&&(this._controls.onDragMove(e),e.stopPropagation())}},{key:"ondragend",value:function(e){this._controls&&(this._controls.onDragEnd(e),e.stopPropagation())}},{key:"ontouchstart",value:function(e){this._controls&&(this._controls.onTouchStart(e),e.stopPropagation())}},{key:"ontouchmove",value:function(e){this._controls&&(this._controls.onTouchMove(e),e.stopPropagation())}},{key:"ontouchend",value:function(e){this._controls&&(this._controls.onTouchEnd(e),e.stopPropagation())}},{key:"onkeydown",value:function(e){this._controls&&(this._controls.onKeyDown(e),e.stopPropagation())}},{key:"handleMouseWheel",value:function(e){var t=0,n=this.model.zoom;t=-e.deltaY,n+=.01*t,0>n&&(n=0),this.set("zoom",n)}},{key:"onWindowFocus",value:function(){console.log("focus!!")}},{key:"onWindowBlur",value:function(){}},{key:"scene3d",get:function(){return this._scene3d||this.init_scene3d(),this._scene3d}},{key:"layout",get:function(){return M.get("three")}}]),t}(P);n["default"]=H,j.register("three-container",H)},{"./forkLift":1,"./humidity-sensor":2,"./path":4,"./person":5,"./plane":6,"./rack":7,"./three-controls":10,"./three-layout":11}],10:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=function(e,t){function n(){return 2*Math.PI/60/60*v.autoRotateSpeed}function o(){return Math.pow(.95,v.zoomSpeed)}function i(e){g-=e}function r(e){w-=e}function a(e){v.object instanceof THREE.PerspectiveCamera?T/=e:v.object instanceof THREE.OrthographicCamera?(v.object.zoom=Math.max(v.minZoom,Math.min(v.maxZoom,v.object.zoom*e)),v.object.updateProjectionMatrix(),O=!0):(console.warn("WARNING: ThreeControls.js encountered an unknown camera type - dolly/zoom disabled."),v.enableZoom=!1)}function s(e){v.object instanceof THREE.PerspectiveCamera?T*=e:v.object instanceof THREE.OrthographicCamera?(v.object.zoom=Math.max(v.minZoom,Math.min(v.maxZoom,v.object.zoom/e)),v.object.updateProjectionMatrix(),O=!0):(console.warn("WARNING: ThreeControls.js encountered an unknown camera type - dolly/zoom disabled."),v.enableZoom=!1)}function c(e){k.set(e.offsetX,e.offsetY)}function h(e){S.set(e.offsetX,e.offsetY)}function l(e){M.set(e.offsetX,e.offsetY)}function u(e){j.set(e.offsetX,e.offsetY),P.subVectors(j,k);var t=v.component;i(2*Math.PI*P.x/t.get("width")*v.rotateSpeed),r(2*Math.PI*P.y/t.get("height")*v.rotateSpeed),k.copy(j),v.update()}function d(e){C.set(e.offsetX,e.offsetY),D.subVectors(C,S),D.y>0?a(o()):D.y<0&&s(o()),S.copy(C),v.update()}function f(e){H.set(e.offsetX,e.offsetY),x.subVectors(H,M),z(x.x,x.y),M.copy(H),v.update()}function p(e){switch(e.keyCode){case v.keys.UP:z(0,v.keyPanSpeed),v.update();break;case v.keys.BOTTOM:z(0,-v.keyPanSpeed),v.update();break;case v.keys.LEFT:z(v.keyPanSpeed,0),v.update();break;case v.keys.RIGHT:z(-v.keyPanSpeed,0),v.update()}}this.object=e,this.component=t,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-(1/0),this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=this.component.model.autoRotate||!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.cameraChanged=!1,this.getPolarAngle=function(){return y},this.getAzimuthalAngle=function(){return m},this.reset=function(){v.target.copy(v.target0),v.object.position.copy(v.position0),v.object.zoom=v.zoom0,v.object.updateProjectionMatrix(),v.update(),b=E.NONE},this.update=function(){var t=new THREE.Vector3,o=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),r=o.clone().inverse(),a=new THREE.Vector3,s=new THREE.Quaternion;return function(){var e=v.object.position;t.copy(e).sub(v.target),t.applyQuaternion(o),m=Math.atan2(t.x,t.z),y=Math.atan2(Math.sqrt(t.x*t.x+t.z*t.z),t.y),v.autoRotate&&b===E.NONE&&i(n()),m+=g,y+=w,m=Math.max(v.minAzimuthAngle,Math.min(v.maxAzimuthAngle,m)),y=Math.max(v.minPolarAngle,Math.min(v.maxPolarAngle,y)),y=Math.max(_,Math.min(Math.PI-_,y));var c=t.length()*T;return c=Math.max(v.minDistance,Math.min(v.maxDistance,c)),v.target.add(R),t.x=c*Math.sin(y)*Math.sin(m),t.y=c*Math.cos(y),t.z=c*Math.sin(y)*Math.cos(m),t.applyQuaternion(r),e.copy(v.target).add(t),v.object.lookAt(v.target),v.enableDamping===!0?(g*=1-v.dampingFactor,w*=1-v.dampingFactor):(g=0,w=0),T=1,R.set(0,0,0),v.cameraChanged||a.distanceToSquared(v.object.position)>_||8*(1-s.dot(v.object.quaternion))>_?(a.copy(v.object.position),s.copy(v.object.quaternion),v.cameraChanged=!1,v.component.render_threed(),!0):!1}}(),this.dispose=function(){},this.onMouseDown=function(){},this.onMouseMove=function(){},this.onMouseUp=function(){},this.onDragStart=function(e){if(this.enabled!==!1&&this.enableRotate!==!1)switch(b=e.altKey===!0?E.PAN:E.ROTATE){case E.ROTATE:this.enableRotate&&c(e);break;case E.DOLLY:this.enableZoom&&h(e);break;case E.PAN:this.enablePan&&l(e)}},this.onDragMove=function(e){if(this.enabled)switch(b=e.altKey===!0?E.PAN:E.ROTATE){case E.ROTATE:this.enableRotate&&u(e);break;case E.DOLLY:this.enableZoom&&d(e);break;case E.PAN:this.enablePan&&f(e)}},this.onDragEnd=function(){this.enabled!==!1&&this.enableRotate!==!1&&(b=E.NONE)},this.onKeyDown=function(e){this.enabled!==!1&&this.enableKeys!==!1&&this.enablePan!==!1&&p(e)},this.onTouchStart=function(){},this.onTouchMove=function(){},this.onTouchEnd=function(){};var m,y,v=this,E={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},b=E.NONE,_=1e-6,w=0,g=0,T=1,R=new THREE.Vector3,O=!1,k=new THREE.Vector2,j=new THREE.Vector2,P=new THREE.Vector2,M=new THREE.Vector2,H=new THREE.Vector2,x=new THREE.Vector2,S=new THREE.Vector2,C=new THREE.Vector2,D=new THREE.Vector2,A=function(){var e=new THREE.Vector3;return function(t,n){var o=n.elements;e.set(o[0],o[1],o[2]),e.multiplyScalar(-t),R.add(e)}}(),L=function(){var e=new THREE.Vector3;return function(t,n){var o=n.elements;e.set(o[4],o[5],o[6]),e.multiplyScalar(t),R.add(e)}}(),z=function(){var e=new THREE.Vector3;return function(t,n){var o=v.component===document?v.component.body:v.component;if(v.object instanceof THREE.PerspectiveCamera){var i=v.object.position;e.copy(i).sub(v.target);var r=e.length();r*=Math.tan(v.object.fov/2*Math.PI/180),A(2*t*r/o.model.height,v.object.matrix),L(2*n*r/o.model.height,v.object.matrix)}else v.object instanceof THREE.OrthographicCamera?(A(t*(v.object.right-v.object.left)/o.model.width,v.object.matrix),L(n*(v.object.top-v.object.bottom)/o.model.height,v.object.matrix)):(console.warn("WARNING: ThreeControls.js encountered an unknown camera type - pan disabled."),v.enablePan=!1)}}();this.update()};o.prototype={},o.prototype.constructor=o,n["default"]=o},{}],11:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=scene,i=o.Layout,r={reflow:function(){},capturables:function(e){return e.get("threed")?[]:e.components},drawables:function(e){return e.get("threed")?[]:e.components},isStuck:function(){return!1}};i.register("three",r),n["default"]=r},{}],12:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=function d(e,t,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,t);if(void 0===o){var i=Object.getPrototypeOf(e);return null===i?void 0:d(i,t,n)}if("value"in o)return o.value;var r=o.get;return void 0===r?void 0:r.call(n)},c=scene,h=c.Rect,l=c.Component,u=function(e){function t(){return o(this,t),i(this,Object.getPrototypeOf(t).apply(this,arguments))}return r(t,e),a(t,[{key:"init_scene",value:function(e,t){var n=this.model,o=n.mute,i=n.loop,r=n.autoplay,a=n.src,s=n.fov,c=n.clickAndDrag,h=n.wheelEnabled;this._dragStart={},this._lon=0,this._lat=0,this._clickAndDrag=c,this._isPlaying=!1,this._wheelEnabled=h,this._fov=s||35,this._fovMin=3,this._fovMax=100,this._time=(new Date).getTime(),this._scene=new THREE.Scene,this._camera=new THREE.PerspectiveCamera(s,e/t,.1,1e3),this._camera.setFocalLength(s),this._renderer=new THREE.WebGLRenderer,this._renderer.setSize(e,t),this._renderer.autoClear=!1,this._renderer.setClearColor(3355443,1),this._video=document.createElement("video"),this._video.setAttribute("crossorigin","anonymous"),this._video.loop=i,this._video.muted=o,this._texture=new THREE.Texture(this._video);var l=this;this._video.addEventListener("ended",function(){this._isPlaying=!1}),this._video.addEventListener("progress",function(){var e=null;l._video&&l._video.buffered&&l._video.buffered.length>0&&l._video.buffered.end&&l._video.duration?e=l._video.buffered.end(0)/l._video.duration:l._video&&void 0!==l._video.bytesTotal&&l._video.bytesTotal>0&&void 0!==l._video.bufferedBytes&&(e=l._video.bufferedBytes/l._video.bytesTotal);Math.round(100*e)}),this._video.addEventListener("canplay",function(){r===!0&&(l.play(),l._videoReady=!0)}),this._video.src=this.app.url(a),this._texture.generateMipmaps=!1,this._texture.minFilter=THREE.LinearFilter,this._texture.magFilter=THREE.LinearFilter,this._texture.format=THREE.RGBFormat,this._mesh=new THREE.Mesh(new THREE.SphereGeometry(500,80,50),new THREE.MeshBasicMaterial({map:this._texture})),this._mesh.scale.x=-1,this._scene.add(this._mesh),this.animate()}},{key:"destroy_scene",value:function(){cancelAnimationFrame(this._requestAnimationId),this._requestAnimationId=void 0,this._texture.dispose(),this._scene.remove(this._mesh),this.unloadVideo(),this._renderer=void 0,this._camera=void 0,this._keyboard=void 0,this._controls=void 0,this._projector=void 0,this._load_manager=void 0,this._scene=void 0,this._video=void 0}},{key:"loadVideo",value:function(e){this._video.src=e}},{key:"unloadVideo",value:function(){this.pause(),this._video.src="",this._video.removeAttribute("src")}},{key:"play",value:function(){this._isPlaying=!0,this._video.play()}},{key:"pause",value:function(){this._isPlaying=!1,this._video.pause()}},{key:"resize",value:function(e,t){this._renderer&&(this._renderer.setSize(e,t),this._camera.aspect=e/t,this._camera.updateProjectionMatrix())}},{key:"animate",value:function(){if(this._requestAnimationId=requestAnimationFrame(this.animate.bind(this)),this._video.readyState===this._video.HAVE_ENOUGH_DATA&&"undefined"!=typeof this._texture){var e=(new Date).getTime();e-this._time>=30&&(this._texture.needsUpdate=!0,this._time=e)}this.render(),this.invalidate()}},{key:"render",value:function(){this._lat=Math.max(-85,Math.min(85,this._lat||0)),this._phi=(90-this._lat)*Math.PI/180,this._theta=(this._lon||0)*Math.PI/180;var e=500*Math.sin(this._phi)*Math.cos(this._theta),t=500*Math.cos(this._phi),n=500*Math.sin(this._phi)*Math.sin(this._theta);this._camera.lookAt(new THREE.Vector3(e,t,n)),this.model.flatProjection?(this._camera.position.x=0,this._camera.position.y=0,this._camera.position.z=0):(this._camera.position.x=-e,this._camera.position.y=-t,this._camera.position.z=-n),this._renderer.clear(),this._renderer.render(this._scene,this._camera)}},{key:"createControls",value:function(){var e=this.options.muted?"fa-volume-off":"fa-volume-up",t=this.options.autoplay?"fa-pause":"fa-play",n='           <div class="controls">               <a href="#" class="playButton button fa '+t+'"></a>               <a href="#" class="muteButton button fa '+e+'"></a>               <a href="#" class="fullscreenButton button fa fa-expand"></a>           </div>       ';$(this.element).append(n,!0),this.options.hideControls&&$(this.element).find(".controls").hide()}},{key:"attachControlEvents",value:function(){var e=this;this.element.addEventListener("mousemove",this.onMouseMove.bind(this),!1),this.element.addEventListener("touchmove",this.onMouseMove.bind(this),!1),this.element.addEventListener("mousewheel",this.onMouseWheel.bind(this),!1),this.element.addEventListener("DOMMouseScroll",this.onMouseWheel.bind(this),!1),this.element.addEventListener("mousedown",this.onMouseDown.bind(this),!1),this.element.addEventListener("touchstart",this.onMouseDown.bind(this),!1),this.element.addEventListener("mouseup",this.onMouseUp.bind(this),!1),this.element.addEventListener("touchend",this.onMouseUp.bind(this),!1),$(document).on("webkitfullscreenchange mozfullscreenchange fullscreenchange",this.fullscreen.bind(this)),$(window).resize(function(){e.resizeGL($(e.element).width(),$(e.element).height())}),$(this.element).find(".playButton").click(function(t){t.preventDefault(),$(this).hasClass("fa-pause")?($(this).removeClass("fa-pause").addClass("fa-play"),e.pause()):($(this).removeClass("fa-play").addClass("fa-pause"),e.play())}),$(this.element).find(".fullscreenButton").click(function(t){t.preventDefault();var n=$(e.element)[0];$(this).hasClass("fa-expand")?n.requestFullscreen?n.requestFullscreen():n.msRequestFullscreen?n.msRequestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.webkitRequestFullscreen&&n.webkitRequestFullscreen():n.requestFullscreen?document.exitFullscreen():n.msRequestFullscreen?document.msExitFullscreen():n.mozRequestFullScreen?document.mozCancelFullScreen():n.webkitRequestFullscreen&&document.webkitExitFullscreen()}),$(this.element).find(".muteButton").click(function(t){t.preventDefault(),$(this).hasClass("fa-volume-off")?($(this).removeClass("fa-volume-off").addClass("fa-volume-up"),e._video.muted=!1):($(this).removeClass("fa-volume-up").addClass("fa-volume-off"),e._video.muted=!0)})}},{key:"_draw",value:function(e){var n=this.model,o=n.left,i=n.top,r=n.width,a=n.height,c=n.src;c?(this._scene||(this.init_scene(r,a),this.render()),e.drawImage(this._renderer.domElement,0,0,r,a,o,i,r,a)):s(Object.getPrototypeOf(t.prototype),"_draw",this).call(this,e)}},{key:"onchange",value:function(e){(e.hasOwnProperty("width")||e.hasOwnProperty("height"))&&this.resize(this.model.width,this.model.height),(e.hasOwnProperty("src")||e.hasOwnProperty("autoplay"))&&this.destroy_scene(),this.invalidate()}},{key:"ondblclick",value:function(e){this._isPlaying?this.pause():this.play(),e.stopPropagation()}},{key:"onmousedown",value:function(){}},{key:"onmousemove",value:function(e){if(this._clickAndDrag===!1){var t,n;this._onPointerDownPointerX=e.offsetX,this._onPointerDownPointerY=-e.offsetY,this._onPointerDownLon=this._lon,this._onPointerDownLat=this._lat,t=e.offsetX-this._renderer.getContext().canvas.offsetLeft,n=e.offsetY-this._renderer.getContext().canvas.offsetTop,this._lon=t/this._renderer.getContext().canvas.width*430-225,this._lat=n/this._renderer.getContext().canvas.height*-180+90}}},{key:"onwheel",value:function(e){if(this._wheelEnabled!==!1){var t=.01;this._fov-=e.deltaY*t,this._fov<this._fovMin?this._fov=this._fovMin:this._fov>this._fovMax&&(this._fov=this._fovMax),this._camera.setFocalLength(this._fov),this._camera.updateProjectionMatrix(),e.stopPropagation()}}},{key:"ondragstart",value:function(e){this._dragStart.x=e.offsetX,this._dragStart.y=e.offsetY}},{key:"ondragmove",value:function(e){if(this._isPlaying!==!1){if(this._clickAndDrag!==!1){this._onPointerDownPointerX=e.offsetX,this._onPointerDownPointerY=-e.offsetY,this._onPointerDownLon=this._lon,this._onPointerDownLat=this._lat;var t,n;t=e.offsetX-this._dragStart.x,n=e.offsetY-this._dragStart.y,this._dragStart.x=e.offsetX,this._dragStart.y=e.offsetY,this._lon+=t,this._lat-=n}e.stopPropagation()}}},{key:"ondragend",value:function(){}},{key:"ontouchstart",value:function(){}},{key:"ontouchmove",value:function(){}},{key:"ontouchend",value:function(){}},{key:"onkeydown",value:function(){}}]),t}(h);n["default"]=u,l.register("video-player-360",u)},{}]},{},[3]);