!function e(t,o,n){function i(a,s){if(!o[a]){if(!t[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(r)return r(a,!0);var h=new Error("Cannot find module '"+a+"'");throw h.code="MODULE_NOT_FOUND",h}var u=o[a]={exports:{}};t[a][0].call(u.exports,function(e){var o=t[a][1][e];return i(o?o:e)},u,u.exports,e,t,o,n)}return o[a].exports}for(var r="function"==typeof require&&require,a=0;a<n.length;a++)i(n[a]);return i}({1:[function(e,t,o){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(){if(!a.done){a.done=!0;var e=new THREE.OBJLoader,t=new THREE.MTLLoader;e.setPath("./obj/Fork_lift/"),t.setPath("./obj/Fork_lift/"),t.load("ForkLift.mtl",function(t){t.preload(),e.setMaterials(t),t.side=THREE.frontSide,e.load("ForkLift.obj",function(e){s=e})})}}Object.defineProperty(o,"__esModule",{value:!0});var s,c=function(){function e(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,o,n){return o&&e(t.prototype,o),n&&e(t,n),t}}(),h=function(e){function t(e,o){n(this,t);var r=i(this,Object.getPrototypeOf(t).call(this));return r._model=e,r.createObject(e,o),r}return r(t,e),c(t,[{key:"createObject",value:function(e,o){if(!t.extObject)return void setTimeout(this.createObject.bind(this,e,o),50);{var n=e.left+e.width/2-o.width/2,i=e.top+e.height/2-o.height/2;.5*e.depth,e.left-o.width/2,e.top-o.height/2,e.rotation}this.type="forklift",this.add(t.extObject.clone()),this.scale.set(10,10,10),this.position.set(n,0,i),this.rotation.y=e.rotation||0}}],[{key:"extObject",get:function(){return s||a(),s}}]),t}(THREE.Object3D);o["default"]=h},{}],2:[function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(o,"__esModule",{value:!0});var i=e("./three-container");Object.defineProperty(o,"ThreeContainer",{enumerable:!0,get:function(){return n(i)["default"]}});var r=e("./video-player-360");Object.defineProperty(o,"VideoPlayer360",{enumerable:!0,get:function(){return n(r)["default"]}})},{"./three-container":7,"./video-player-360":10}],3:[function(e,t,o){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(){if(!a.done){a.done=!0;var e=new THREE.TGALoader;THREE.Loader.Handlers.add(/\.tga$/i,e);var t=new THREE.OBJLoader,o=new THREE.MTLLoader;t.setPath("./obj/Casual_Man_02/"),o.setPath("./obj/Casual_Man_02/"),o.load("Casual_Man.mtl",function(e){e.preload(),t.setMaterials(e),e.side=THREE.frontSide,t.load("Casual_Man.obj",function(e){s=e})})}}Object.defineProperty(o,"__esModule",{value:!0});var s,c=function(){function e(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,o,n){return o&&e(t.prototype,o),n&&e(t,n),t}}(),h=function(e){function t(e,o){n(this,t);var r=i(this,Object.getPrototypeOf(t).call(this));return r._model=e,r.createObject(e,o),r}return r(t,e),c(t,[{key:"createObject",value:function(e,o){if(!t.extObject)return void setTimeout(this.createObject.bind(this,e,o),50);{var n=e.left+e.width/2-o.width/2,i=e.top+e.height/2-o.height/2;.5*e.depth,e.left-o.width/2,e.top-o.height/2,e.rotation}this.type="person",this.add(t.extObject.clone()),this.scale.set(10,10,10),this.position.set(n,0,i),this.rotation.y=e.rotation||0}}],[{key:"extObject",get:function(){return s||a(),s}}]),t}(THREE.Object3D);o["default"]=h},{}],4:[function(e,t,o){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(o,"__esModule",{value:!0});var a=function(){function e(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,o,n){return o&&e(t.prototype,o),n&&e(t,n),t}}(),s=scene,c=(s.Component,function(e){function t(e,o){n(this,t);var r=i(this,Object.getPrototypeOf(t).call(this));return r._model=e,r.createObject(e,o),r}return r(t,e),a(t,[{key:"createObject",value:function(e,t){this.createPlane(e.width,e.height,e.fillStyle);var o=e.left+e.width/2-t.width/2,n=e.top+e.height/2-t.height/2;this.position.x=o,this.position.z=n}},{key:"createPlane",value:function(e,t,o){if(this.geometry=new THREE.PlaneGeometry(e,t),o&&"pattern"==o.type&&o.image){var n=(new THREE.TextureLoader).load(o.image);n.wrapS=THREE.RepeatWrapping,n.wrapT=THREE.RepeatWrapping,n.repeat.set(1,1),this.material=new THREE.MeshBasicMaterial({map:n,side:THREE.FrontSide})}else this.material=new THREE.MeshBasicMaterial({color:o||"#ccaa76",side:THREE.FrontSide});this.rotation.x=-Math.PI/2,this.type="rect"}}]),t}(THREE.Mesh));o["default"]=c},{}],5:[function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(o,"__esModule",{value:!0});var s=function(){function e(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,o,n){return o&&e(t.prototype,o),n&&e(t,n),t}}(),c=e("./stock"),h=n(c),u=function(e){function t(e,o){i(this,t);var n=r(this,Object.getPrototypeOf(t).call(this));return n._model=e,n.createObject(e,o),n}return a(t,e),s(t,[{key:"createObject",value:function(e,t){var o=.7,n=e.left+e.width/2-t.width/2,i=e.top+e.height/2-t.height/2,r=.5*e.depth*e.shelves,a=e.rotation;this.type=e.type;var s=this.createRackFrame(e.width,e.height,e.depth*e.shelves);this.add(s);for(var c=0;c<e.shelves;c++){var u=-e.depth*e.shelves*.5;if(c>0){var l=this.createRackBoard(e.width,e.height);l.position.set(0,u+e.depth*c,0),l.rotation.x=Math.PI/2,l.material.opacity=.5,l.material.transparent=!0,this.add(l)}var d=new h["default"]({width:e.width*o,height:e.height*o,depth:e.depth*o}),f=e.depth*o;d.position.set(0,u+e.depth*c+.5*f,0),d.name=e.location+"-"+(c+1),this.add(d)}this.position.set(n,r,i),this.rotation.y=a||0}},{key:"createRackFrame",value:function(e,t,o){return this.geometry=this.cube({width:e,height:o,depth:t}),new THREE.LineSegments(this.geometry,new THREE.LineDashedMaterial({color:13421772,dashSize:3,gapSize:1,linewidth:1}))}},{key:"createRackBoard",value:function(e,t){var o=new THREE.MeshBasicMaterial({color:"#dedede",side:THREE.DoubleSide}),n=new THREE.PlaneGeometry(e,t,1,1),i=new THREE.Mesh(n,o);return i}},{key:"cube",value:function(e){var t=.5*e.width,o=.5*e.height,n=.5*e.depth,i=new THREE.Geometry;return i.vertices.push(new THREE.Vector3(-t,-o,-n),new THREE.Vector3(-t,o,-n),new THREE.Vector3(-t,o,-n),new THREE.Vector3(t,o,-n),new THREE.Vector3(t,o,-n),new THREE.Vector3(t,-o,-n),new THREE.Vector3(t,-o,-n),new THREE.Vector3(-t,-o,-n),new THREE.Vector3(-t,-o,n),new THREE.Vector3(-t,o,n),new THREE.Vector3(-t,o,n),new THREE.Vector3(t,o,n),new THREE.Vector3(t,o,n),new THREE.Vector3(t,-o,n),new THREE.Vector3(t,-o,n),new THREE.Vector3(-t,-o,n),new THREE.Vector3(-t,-o,-n),new THREE.Vector3(-t,-o,n),new THREE.Vector3(-t,o,-n),new THREE.Vector3(-t,o,n),new THREE.Vector3(t,o,-n),new THREE.Vector3(t,o,n),new THREE.Vector3(t,-o,-n),new THREE.Vector3(t,-o,n)),i}},{key:"raycast",value:function(){}}]),t}(THREE.Object3D);o["default"]=u},{"./stock":6}],6:[function(e,t,o){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(o,"__esModule",{value:!0});var a=function(){function e(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,o,n){return o&&e(t.prototype,o),n&&e(t,n),t}}(),s=function(e){function t(e){n(this,t);var o=i(this,Object.getPrototypeOf(t).call(this));return o._model=e,o.createObject(e),o}return r(t,e),a(t,[{key:"createObject",value:function(e){this.createStock(e.width,e.height,e.depth)}},{key:"createStock",value:function(e,t,o){this.geometry=new THREE.BoxGeometry(e,o,t),this.material=new THREE.MeshLambertMaterial({color:"#ccaa76",side:THREE.FrontSide}),this.type="stock"}}]),t}(THREE.Mesh);o["default"]=s},{}],7:[function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(){s.done||(THREE.Loader.Handlers.add(/\.tga$/i,new THREE.TGALoader),s.done=!0)}Object.defineProperty(o,"__esModule",{value:!0});var c=function(){function e(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,o,n){return o&&e(t.prototype,o),n&&e(t,n),t}}(),h=function j(e,t,o){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,t);if(void 0===n){var i=Object.getPrototypeOf(e);return null===i?void 0:j(i,t,o)}if("value"in n)return n.value;var r=n.get;return void 0===r?void 0:r.call(o)},u=e("./rack"),l=n(u),d=e("./plane"),f=n(d),p=e("./forkLift"),m=n(p),y=e("./person"),E=n(y),v=e("./three-layout"),_=(n(v),e("./three-controls")),b=n(_),w=["black","#ccaa76","#ff1100","#252525","#6ac428"],g=scene,T=g.Component,R=g.Container,O=g.Layout,P=function(e){function t(){return i(this,t),r(this,Object.getPrototypeOf(t).apply(this,arguments))}return a(t,e),c(t,[{key:"createFloor",value:function(e,t,o){var n,i=this.model.fillStyle,r=this;if("pattern"==i.type&&i.image){var a=(new THREE.TextureLoader).load(i.image,function(){r.render_threed()});a.premultiplyAlpha=!0,a.wrapS=THREE.MirroredRepeatWrapping,a.wrapT=THREE.MirroredRepeatWrapping,n=new THREE.MeshBasicMaterial({map:a,side:THREE.DoubleSide})}else n=new THREE.MeshBasicMaterial({color:e,side:THREE.FrontSide});var s=new THREE.PlaneGeometry(t,o),c=new THREE.Mesh(s,n);c.position.y=-1,c.rotation.x=-Math.PI/2,this._scene3d.add(c)}},{key:"createObjects",value:function(e,t){var o=new THREE.Object3D;e.forEach(function(e){var n;switch(e.type){case"rack":n=new l["default"](e,t);break;case"forklift":n=new m["default"](e,t);break;case"person":n=new E["default"](e,t);break;case"rect":n=new f["default"](e,t)}o.add(n)}),this._scene3d.add(o)}},{key:"destroy_scene3d",value:function(){this.stop(),this._renderer&&this._renderer.clear(),this._renderer=void 0,this._camera=void 0,this._keyboard=void 0,this._controls=void 0,this._projector=void 0,this._load_manager=void 0,this._scene3d=void 0}},{key:"init_scene3d",value:function(){this._mouse={x:0,y:0,originX:0,originY:0},this.tooltip||this.createTooltip(),this._scene3d&&this.destroy_scene3d(),window.addEventListener("focus",this.onWindowFocus.bind(this)),window.addEventListener("blur",this.onWindowBlur.bind(this)),s();var e=this.model,t=e.width,o=e.height,n=e.fov,i=void 0===n?45:n,r=e.near,a=void 0===r?.1:r,c=e.far,h=void 0===c?2e4:c,u=e.fillStyle,l=void 0===u?"#424b57":u,d=e.light,f=void 0===d?16777215:d,p=e.components,m=void 0===p?[]:p;this._scene3d=new THREE.Scene;var y=t/o;this._camera=new THREE.PerspectiveCamera(i,y,a,h),this._scene3d.add(this._camera),this._camera.position.set(800,800,800),this._camera.lookAt(this._scene3d.position),this._renderer=new THREE.WebGLRenderer({precision:"mediump",alpha:!0}),this._renderer.setClearColor(0,0),this._renderer.setSize(t,o),this._controls=new b["default"](this._camera,this);var E=new THREE.PointLight(f);E.position.set(10,10,0),this._camera.add(E),this.createFloor(l,t,o),this.createObjects(m,{width:t,height:o}),this._projector=new THREE.Projector,this._load_manager=new THREE.LoadingManager,this._load_manager.onProgress=function(){},this.animate()}},{key:"animate",value:function(){this._animationFrame=requestAnimationFrame(this.animate.bind(this)),this.update()}},{key:"stop",value:function(){cancelAnimationFrame(this._animationFrame)}},{key:"update",value:function(){var e=this.tooltip||{},t=new THREE.Vector3(this._mouse.x,this._mouse.y,1);if(this._camera){t.unproject(this._camera);var o=new THREE.Raycaster(this._camera.position,t.sub(this._camera.position).normalize()),n=o.intersectObjects(this._scene3d.children,!0);if(n.length>0){if(n[0].object!=this.INTERSECTED)if(this.INTERSECTED=n[0].object,"stock"===this.INTERSECTED.type){if(!this.INTERSECTED.visible)return;this.INTERSECTED.userData||(this.INTERSECTED.userData={});{this.INTERSECTED.name,this.INTERSECTED.userData.status,this.INTERSECTED.userData.boxId,this.INTERSECTED.userData.inDate,this.INTERSECTED.userData.type,this.INTERSECTED.userData.count}e.textContent="";for(var i in this.INTERSECTED.userData)this.INTERSECTED.userData[i]&&(e.textContent+=i+": "+this.INTERSECTED.userData[i]+"\n");if(e.textContent.length>0){{(this._mouse.x+1)/2*this.model.width,(-this._mouse.y+1)/2*this.model.height}e.style.left=this._mouse.originX+20+"px",e.style.top=this._mouse.originY-20+"px",e.style.display="block"}else e.style.display="none"}else e.style.display="none"}else this.INTERSECTED=null,e.style.display="none";this._controls.update()}}},{key:"createTooltip",value:function(){var e=this.tooltip=document.createElement("div");e.style.position="absolute",e.style.left="0px",e.style.top="0px",e.style["background-color"]="#fff",e.style["max-width"]="200px",e.style.border="3px solid #ccc",e.style.padding="5px 10px",e.style["border-radius"]="10px",e.style.display="none",e.style["z-index"]=100,e.style["white-space"]="pre-line",document.body.appendChild(e)}},{key:"render_threed",value:function(){this._renderer&&this._renderer.render(this.scene3d,this._camera),this.invalidate()}},{key:"_draw",value:function(e){{var o=this.model,n=o.left,i=o.top,r=o.width,a=o.height,s=o.threed;o.fov,o.near,o.far,o.zoom,o.light}s?(this._scene3d||(this.init_scene3d(),this.render_threed()),e.drawImage(this._renderer.domElement,0,0,r,a,n,i,r,a)):h(Object.getPrototypeOf(t.prototype),"_draw",this).call(this,e)}},{key:"onchange",value:function(e){var t=this;if((e.hasOwnProperty("width")||e.hasOwnProperty("height")||e.hasOwnProperty("threed"))&&this.destroy_scene3d(),e.hasOwnProperty("autoRotate")&&(this._controls.autoRotate=e.autoRotate),(e.hasOwnProperty("fov")||e.hasOwnProperty("near")||e.hasOwnProperty("far")||e.hasOwnProperty("zoom"))&&(this._camera.near=this.model.near,this._camera.far=this.model.far,this._camera.zoom=.01*this.model.zoom,this._camera.fov=this.model.fov,this._camera.updateProjectionMatrix(),this._controls.cameraChanged=!0),e.hasOwnProperty("data")){var o=e.data;o.forEach(function(e){var o=t._scene3d.getObjectByName(e.loc,!0);o&&(o.userData=e),o&&(o.material.color.set(w[e.status]),o.visible=0===e.status?!1:!0)})}this.invalidate()}},{key:"onmousedown",value:function(e){this._controls&&this._controls.onMouseDown(e)}},{key:"onmousemove",value:function(e){if(this._controls){var t=this.transcoordC2S(e.offsetX,e.offsetY);this._mouse.originX=e.offsetX,this._mouse.originY=e.offsetY,this._mouse.x=(t.x-this.model.left)/this.model.width*2-1,this._mouse.y=2*-((t.y-this.model.top)/this.model.height)+1,this._controls.onMouseMove(e),e.stopPropagation()}}},{key:"onwheel",value:function(e){this._controls&&(this.handleMouseWheel(e),e.stopPropagation())}},{key:"ondragstart",value:function(e){this._controls&&(this._controls.onDragStart(e),e.stopPropagation())}},{key:"ondragmove",value:function(e){this._controls&&(this._controls.onDragMove(e),e.stopPropagation())}},{key:"ondragend",value:function(e){this._controls&&(this._controls.onDragEnd(e),e.stopPropagation())}},{key:"ontouchstart",value:function(e){this._controls&&(this._controls.onTouchStart(e),e.stopPropagation())}},{key:"ontouchmove",value:function(e){this._controls&&(this._controls.onTouchMove(e),e.stopPropagation())}},{key:"ontouchend",value:function(e){this._controls&&(this._controls.onTouchEnd(e),e.stopPropagation())}},{key:"onkeydown",value:function(e){this._controls&&(this._controls.onKeyDown(e),e.stopPropagation())}},{key:"handleMouseWheel",value:function(e){var t=0,o=this.model.zoom;t=-e.deltaY,o+=.01*t,0>o&&(o=0),this.set("zoom",o)}},{key:"onWindowFocus",value:function(){console.log("focus!!")}},{key:"onWindowBlur",value:function(){}},{key:"scene3d",get:function(){return this._scene3d||this.init_scene3d(),this._scene3d}},{key:"layout",get:function(){return O.get("three")}}]),t}(R);o["default"]=P,T.register("three-container",P)},{"./forkLift":1,"./person":3,"./plane":4,"./rack":5,"./three-controls":8,"./three-layout":9}],8:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var n=function(e,t){function o(){return 2*Math.PI/60/60*E.autoRotateSpeed}function n(){return Math.pow(.95,E.zoomSpeed)}function i(e){g-=e}function r(e){w-=e}function a(e){E.object instanceof THREE.PerspectiveCamera?T/=e:E.object instanceof THREE.OrthographicCamera?(E.object.zoom=Math.max(E.minZoom,Math.min(E.maxZoom,E.object.zoom*e)),E.object.updateProjectionMatrix(),O=!0):(console.warn("WARNING: ThreeControls.js encountered an unknown camera type - dolly/zoom disabled."),E.enableZoom=!1)}function s(e){E.object instanceof THREE.PerspectiveCamera?T*=e:E.object instanceof THREE.OrthographicCamera?(E.object.zoom=Math.max(E.minZoom,Math.min(E.maxZoom,E.object.zoom/e)),E.object.updateProjectionMatrix(),O=!0):(console.warn("WARNING: ThreeControls.js encountered an unknown camera type - dolly/zoom disabled."),E.enableZoom=!1)}function c(e){P.set(e.offsetX,e.offsetY)}function h(e){S.set(e.offsetX,e.offsetY)}function u(e){M.set(e.offsetX,e.offsetY)}function l(e){j.set(e.offsetX,e.offsetY),k.subVectors(j,P);var t=E.component;i(2*Math.PI*k.x/t.get("width")*E.rotateSpeed),r(2*Math.PI*k.y/t.get("height")*E.rotateSpeed),P.copy(j),E.update()}function d(e){D.set(e.offsetX,e.offsetY),C.subVectors(D,S),C.y>0?a(n()):C.y<0&&s(n()),S.copy(D),E.update()}function f(e){H.set(e.offsetX,e.offsetY),x.subVectors(H,M),F(x.x,x.y),M.copy(H),E.update()}function p(e){switch(e.keyCode){case E.keys.UP:F(0,E.keyPanSpeed),E.update();break;case E.keys.BOTTOM:F(0,-E.keyPanSpeed),E.update();break;case E.keys.LEFT:F(E.keyPanSpeed,0),E.update();break;case E.keys.RIGHT:F(-E.keyPanSpeed,0),E.update()}}this.object=e,this.component=t,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-(1/0),this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=this.component.model.autoRotate||!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.cameraChanged=!1,this.getPolarAngle=function(){return y},this.getAzimuthalAngle=function(){return m},this.reset=function(){E.target.copy(E.target0),E.object.position.copy(E.position0),E.object.zoom=E.zoom0,E.object.updateProjectionMatrix(),E.update(),_=v.NONE},this.update=function(){var t=new THREE.Vector3,n=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),r=n.clone().inverse(),a=new THREE.Vector3,s=new THREE.Quaternion;return function(){var e=E.object.position;t.copy(e).sub(E.target),t.applyQuaternion(n),m=Math.atan2(t.x,t.z),y=Math.atan2(Math.sqrt(t.x*t.x+t.z*t.z),t.y),E.autoRotate&&_===v.NONE&&i(o()),m+=g,y+=w,m=Math.max(E.minAzimuthAngle,Math.min(E.maxAzimuthAngle,m)),y=Math.max(E.minPolarAngle,Math.min(E.maxPolarAngle,y)),y=Math.max(b,Math.min(Math.PI-b,y));var c=t.length()*T;return c=Math.max(E.minDistance,Math.min(E.maxDistance,c)),E.target.add(R),t.x=c*Math.sin(y)*Math.sin(m),t.y=c*Math.cos(y),t.z=c*Math.sin(y)*Math.cos(m),t.applyQuaternion(r),e.copy(E.target).add(t),E.object.lookAt(E.target),E.enableDamping===!0?(g*=1-E.dampingFactor,w*=1-E.dampingFactor):(g=0,w=0),T=1,R.set(0,0,0),E.cameraChanged||a.distanceToSquared(E.object.position)>b||8*(1-s.dot(E.object.quaternion))>b?(a.copy(E.object.position),s.copy(E.object.quaternion),E.cameraChanged=!1,E.component.render_threed(),!0):!1}}(),this.dispose=function(){},this.onMouseDown=function(){},this.onMouseMove=function(){},this.onMouseUp=function(){},this.onDragStart=function(e){if(this.enabled!==!1&&this.enableRotate!==!1)switch(_=e.altKey===!0?v.PAN:v.ROTATE){case v.ROTATE:this.enableRotate&&c(e);break;case v.DOLLY:this.enableZoom&&h(e);break;case v.PAN:this.enablePan&&u(e)}},this.onDragMove=function(e){if(this.enabled)switch(_=e.altKey===!0?v.PAN:v.ROTATE){case v.ROTATE:this.enableRotate&&l(e);break;case v.DOLLY:this.enableZoom&&d(e);break;case v.PAN:this.enablePan&&f(e)}},this.onDragEnd=function(){this.enabled!==!1&&this.enableRotate!==!1&&(_=v.NONE)},this.onKeyDown=function(e){this.enabled!==!1&&this.enableKeys!==!1&&this.enablePan!==!1&&p(e)},this.onTouchStart=function(){},this.onTouchMove=function(){},this.onTouchEnd=function(){};var m,y,E=this,v={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},_=v.NONE,b=1e-6,w=0,g=0,T=1,R=new THREE.Vector3,O=!1,P=new THREE.Vector2,j=new THREE.Vector2,k=new THREE.Vector2,M=new THREE.Vector2,H=new THREE.Vector2,x=new THREE.Vector2,S=new THREE.Vector2,D=new THREE.Vector2,C=new THREE.Vector2,L=function(){var e=new THREE.Vector3;return function(t,o){var n=o.elements;e.set(n[0],n[1],n[2]),e.multiplyScalar(-t),R.add(e)}}(),A=function(){var e=new THREE.Vector3;return function(t,o){var n=o.elements;e.set(n[4],n[5],n[6]),e.multiplyScalar(t),R.add(e)}}(),F=function(){var e=new THREE.Vector3;return function(t,o){var n=E.component===document?E.component.body:E.component;if(E.object instanceof THREE.PerspectiveCamera){var i=E.object.position;e.copy(i).sub(E.target);var r=e.length();r*=Math.tan(E.object.fov/2*Math.PI/180),L(2*t*r/n.model.height,E.object.matrix),A(2*o*r/n.model.height,E.object.matrix)}else E.object instanceof THREE.OrthographicCamera?(L(t*(E.object.right-E.object.left)/n.model.width,E.object.matrix),A(o*(E.object.top-E.object.bottom)/n.model.height,E.object.matrix)):(console.warn("WARNING: ThreeControls.js encountered an unknown camera type - pan disabled."),E.enablePan=!1)}}();this.update()};n.prototype={},n.prototype.constructor=n,o["default"]=n},{}],9:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var n=scene,i=n.Layout,r={reflow:function(){},capturables:function(e){return e.get("threed")?[]:e.components},drawables:function(e){return e.get("threed")?[]:e.components},isStuck:function(){return!1}};i.register("three",r),o["default"]=r},{}],10:[function(e,t,o){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(o,"__esModule",{value:!0});var a=function(){function e(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,o,n){return o&&e(t.prototype,o),n&&e(t,n),t}}(),s=function d(e,t,o){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,t);if(void 0===n){var i=Object.getPrototypeOf(e);return null===i?void 0:d(i,t,o)}if("value"in n)return n.value;var r=n.get;return void 0===r?void 0:r.call(o)},c=scene,h=c.Rect,u=c.Component,l=function(e){function t(){return n(this,t),i(this,Object.getPrototypeOf(t).apply(this,arguments))}return r(t,e),a(t,[{key:"init_scene",value:function(e,t){var o=this.model,n=o.mute,i=o.loop,r=o.autoplay,a=o.src,s=o.fov,c=o.clickAndDrag,h=o.wheelEnabled;this._dragStart={},this._lon=0,this._lat=0,this._clickAndDrag=c,this._isPlaying=!1,this._wheelEnabled=h,this._fov=s||35,this._fovMin=3,this._fovMax=100,this._time=(new Date).getTime(),this._scene=new THREE.Scene,this._camera=new THREE.PerspectiveCamera(s,e/t,.1,1e3),this._camera.setFocalLength(s),this._renderer=new THREE.WebGLRenderer,this._renderer.setSize(e,t),this._renderer.autoClear=!1,this._renderer.setClearColor(3355443,1),this._video=document.createElement("video"),this._video.setAttribute("crossorigin","anonymous"),this._video.loop=i,this._video.muted=n,this._texture=new THREE.Texture(this._video);var u=this;this._video.addEventListener("ended",function(){this._isPlaying=!1}),this._video.addEventListener("progress",function(){var e=null;u._video&&u._video.buffered&&u._video.buffered.length>0&&u._video.buffered.end&&u._video.duration?e=u._video.buffered.end(0)/u._video.duration:u._video&&void 0!==u._video.bytesTotal&&u._video.bytesTotal>0&&void 0!==u._video.bufferedBytes&&(e=u._video.bufferedBytes/u._video.bytesTotal);Math.round(100*e)}),this._video.addEventListener("canplay",function(){r===!0&&(u.play(),u._videoReady=!0)}),this._video.src=a,this._texture.generateMipmaps=!1,this._texture.minFilter=THREE.LinearFilter,this._texture.magFilter=THREE.LinearFilter,this._texture.format=THREE.RGBFormat,this._mesh=new THREE.Mesh(new THREE.SphereGeometry(500,80,50),new THREE.MeshBasicMaterial({map:this._texture})),this._mesh.scale.x=-1,this._scene.add(this._mesh),this.animate()}},{key:"destroy_scene",value:function(){cancelAnimationFrame(this._requestAnimationId),this._requestAnimationId=void 0,this._texture.dispose(),this._scene.remove(this._mesh),this.unloadVideo(),this._renderer=void 0,this._camera=void 0,this._keyboard=void 0,this._controls=void 0,this._projector=void 0,this._load_manager=void 0,this._scene=void 0,this._video=void 0}},{key:"loadVideo",value:function(e){this._video.src=e}},{key:"unloadVideo",value:function(){this.pause(),this._video.src="",this._video.removeAttribute("src")}},{key:"play",value:function(){this._isPlaying=!0,this._video.play()}},{key:"pause",value:function(){this._isPlaying=!1,this._video.pause()}},{key:"resize",value:function(e,t){this._renderer.setSize(e,t),this._camera.aspect=e/t,this._camera.updateProjectionMatrix()}},{key:"animate",value:function(){if(this._requestAnimationId=requestAnimationFrame(this.animate.bind(this)),this._video.readyState===this._video.HAVE_ENOUGH_DATA&&"undefined"!=typeof this._texture){var e=(new Date).getTime();e-this._time>=30&&(this._texture.needsUpdate=!0,this._time=e)}this.render(),this.invalidate()}},{key:"render",value:function(){this._lat=Math.max(-85,Math.min(85,this._lat||0)),this._phi=(90-this._lat)*Math.PI/180,this._theta=(this._lon||0)*Math.PI/180;var e=500*Math.sin(this._phi)*Math.cos(this._theta),t=500*Math.cos(this._phi),o=500*Math.sin(this._phi)*Math.sin(this._theta);this._camera.lookAt(new THREE.Vector3(e,t,o)),this.model.flatProjection?(this._camera.position.x=0,this._camera.position.y=0,this._camera.position.z=0):(this._camera.position.x=-e,this._camera.position.y=-t,this._camera.position.z=-o),this._renderer.clear(),this._renderer.render(this._scene,this._camera)}},{key:"createControls",value:function(){var e=this.options.muted?"fa-volume-off":"fa-volume-up",t=this.options.autoplay?"fa-pause":"fa-play",o='           <div class="controls">               <a href="#" class="playButton button fa '+t+'"></a>               <a href="#" class="muteButton button fa '+e+'"></a>               <a href="#" class="fullscreenButton button fa fa-expand"></a>           </div>       ';$(this.element).append(o,!0),this.options.hideControls&&$(this.element).find(".controls").hide()}},{key:"attachControlEvents",value:function(){var e=this;this.element.addEventListener("mousemove",this.onMouseMove.bind(this),!1),this.element.addEventListener("touchmove",this.onMouseMove.bind(this),!1),this.element.addEventListener("mousewheel",this.onMouseWheel.bind(this),!1),this.element.addEventListener("DOMMouseScroll",this.onMouseWheel.bind(this),!1),this.element.addEventListener("mousedown",this.onMouseDown.bind(this),!1),this.element.addEventListener("touchstart",this.onMouseDown.bind(this),!1),this.element.addEventListener("mouseup",this.onMouseUp.bind(this),!1),this.element.addEventListener("touchend",this.onMouseUp.bind(this),!1),$(document).on("webkitfullscreenchange mozfullscreenchange fullscreenchange",this.fullscreen.bind(this)),$(window).resize(function(){e.resizeGL($(e.element).width(),$(e.element).height())}),$(this.element).find(".playButton").click(function(t){t.preventDefault(),$(this).hasClass("fa-pause")?($(this).removeClass("fa-pause").addClass("fa-play"),e.pause()):($(this).removeClass("fa-play").addClass("fa-pause"),e.play())}),$(this.element).find(".fullscreenButton").click(function(t){t.preventDefault();var o=$(e.element)[0];$(this).hasClass("fa-expand")?o.requestFullscreen?o.requestFullscreen():o.msRequestFullscreen?o.msRequestFullscreen():o.mozRequestFullScreen?o.mozRequestFullScreen():o.webkitRequestFullscreen&&o.webkitRequestFullscreen():o.requestFullscreen?document.exitFullscreen():o.msRequestFullscreen?document.msExitFullscreen():o.mozRequestFullScreen?document.mozCancelFullScreen():o.webkitRequestFullscreen&&document.webkitExitFullscreen();

}),$(this.element).find(".muteButton").click(function(t){t.preventDefault(),$(this).hasClass("fa-volume-off")?($(this).removeClass("fa-volume-off").addClass("fa-volume-up"),e._video.muted=!1):($(this).removeClass("fa-volume-up").addClass("fa-volume-off"),e._video.muted=!0)})}},{key:"_draw",value:function(e){var o=this.model,n=o.left,i=o.top,r=o.width,a=o.height,c=o.src;c?(this._scene||(this.init_scene(r,a),this.render()),e.drawImage(this._renderer.domElement,0,0,r,a,n,i,r,a)):s(Object.getPrototypeOf(t.prototype),"_draw",this).call(this,e)}},{key:"onchange",value:function(e){(e.hasOwnProperty("width")||e.hasOwnProperty("height"))&&this.resize(this.model.width,this.model.height),e.hasOwnProperty("src")&&this.destroy_scene(),this.invalidate()}},{key:"ondblclick",value:function(e){this._isPlaying?this.pause():this.play(),e.stopPropagation()}},{key:"onmousedown",value:function(){}},{key:"onmousemove",value:function(e){if(this._clickAndDrag===!1){var t,o;this._onPointerDownPointerX=e.offsetX,this._onPointerDownPointerY=-e.offsetY,this._onPointerDownLon=this._lon,this._onPointerDownLat=this._lat,t=e.offsetX-this._renderer.getContext().canvas.offsetLeft,o=e.offsetY-this._renderer.getContext().canvas.offsetTop,this._lon=t/this._renderer.getContext().canvas.width*430-225,this._lat=o/this._renderer.getContext().canvas.height*-180+90}}},{key:"onwheel",value:function(e){if(this._wheelEnabled!==!1){var t=.01;this._fov-=e.deltaY*t,this._fov<this._fovMin?this._fov=this._fovMin:this._fov>this._fovMax&&(this._fov=this._fovMax),this._camera.setFocalLength(this._fov),this._camera.updateProjectionMatrix(),e.stopPropagation()}}},{key:"ondragstart",value:function(e){this._dragStart.x=e.offsetX,this._dragStart.y=e.offsetY}},{key:"ondragmove",value:function(e){if(this._isPlaying!==!1){if(this._clickAndDrag!==!1){this._onPointerDownPointerX=e.offsetX,this._onPointerDownPointerY=-e.offsetY,this._onPointerDownLon=this._lon,this._onPointerDownLat=this._lat;var t,o;t=e.offsetX-this._dragStart.x,o=e.offsetY-this._dragStart.y,this._dragStart.x=e.offsetX,this._dragStart.y=e.offsetY,this._lon+=t,this._lat-=o}e.stopPropagation()}}},{key:"ondragend",value:function(){}},{key:"ontouchstart",value:function(){}},{key:"ontouchmove",value:function(){}},{key:"ontouchend",value:function(){}},{key:"onkeydown",value:function(){}}]),t}(h);o["default"]=l,u.register("video-player-360",l)},{}]},{},[2]);